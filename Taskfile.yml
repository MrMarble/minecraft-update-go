# https://taskfile.dev

version: "3"

tasks:
  build:
    cmds:
      - go build -o dist/ -v ./...
    silent: true

  fmt:
    cmds:
      - go vet ./...
      - go fmt ./...

  test:
    cmds:
      - go test -cover ./...

  run:
    cmds:
      - go run cmd/minecraft/main.go {{.CLI_ARGS}}
    silent: true

  release:
    desc: Create a new tag
    vars:
      NEXT:
        sh: svu n
    cmds:
      - git tag {{.NEXT}}
      - echo {{.NEXT}}
      - git push origin --tags


  goreleaser:
    desc: Run GoReleaser either in snapshot or release mode
    deps:
      - build
    vars:
      SNAPSHOT:
        sh: 'if [[ $GITHUB_REF != refs/tags/v* ]]; then echo "--snapshot"; fi'
    cmds:
      - goreleaser release --rm-dist {{.SNAPSHOT}}